Object.extend=function(a,b){if(Object.isAssocArray(b)){if(a==null||Object.isUndefined(a))a={};for(var c in b)Object.isNull(b[c])?a[c]=null:Object.isAssocArray(b[c])?(Object.isAssocArray(a[c])||(a[c]={}),a[c]=Object.extend(a[c],b[c])):a[c]=Object.isArray(b[c])?Object.extend(a[c],b[c]):b[c]}else if(Object.isArray(b)){Object.isArray(a)||(a=[]);c=0;for(var d=b.length;c<d;c++)a[c]=Object.extend(a[c],b[c])}else a=b;return a};Object.clone=function(a){var b={};return b=Object.extend(b,a)};
Object.isUndefined=function(a){return typeof a=="undefined"};Object.isDefined=function(a){return typeof a!="undefined"};Object.isFunction=function(a){return typeof a=="function"};Object.isString=function(a){return typeof a=="string"};Object.isNumber=function(a){return typeof a=="number"};Object.isNumeric=function(a){return a!==null&&typeof a!="boolean"&&Object.prototype.toString.call(a)!=="[object Array]"&&!isNaN(Number(a))};Object.isElement=function(a){return a&&a.nodeType==1};
Object.isArray=function(a){return Object.prototype.toString.call(a)==="[object Array]"};Object.isDate=function(a){return Object.prototype.toString.call(a)==="[object Date]"};Object.isNull=function(a){return a===null};Object.isAssocArray=function(a){return a===null?false:Object.prototype.toString.call(a)==="[object Object]"};Object.isBoolean=function(a){return typeof a=="boolean"};
Object.isEmpty=function(a,b){if(!a||Object.isUndefined(a)||Object.isNull(a)||Object.isArray(a)&&a.length===0||Object.isString(a)&&(a.trim()===""||a==="0")||Object.isNumber(a&&a===0))return true;else if(b&&/^(\t*)|(\v*)|(\s*)$/.test(a))return true;return false};Object.toQueryString=function(a){if(this.isString(a))return a;var b="",c;for(c in a)!this.isFunction(a[c])&&typeof a[c]!="object"&&(b+=encodeURIComponent(c)+"="+encodeURIComponent(a[c])+"&");return b};
Object.toIndexedArray=function(a){var b=[],c;for(c in a)b.push(a[c]);return b};Object.toArray=function(a){if(Object.isArray(a))return a;if(Object.isString(a))return a.split("");else if(!Object.isNumber(a)&&Object.isAssocArray(a)){var b=[];if(Object.isIndexed(a))for(item in a)Object.isNumber(item)&&(b[item]=a[item]);else{var c=-1;for(item in a)c++,Object.isNumber(item)&&Object.isDefined(b[c])?(b[c+1]=b[c],b[c]=a[item],c++):b[c]=a[item]}return b}return[a]};
Object.isIndexed=function(a){if(Object.isAssocArray(a)){var b=false,c;for(c in a)if(b=true,!Object.isNumeric(c))return false;return b}return false};Object.ifSetOr=function(a,b){return Object.isDefined(a)?a:b||null};
Object.isEqual=function(a,b){var c;if(typeof a!=typeof b)return false;for(c in a)if(typeof b[c]=="undefined")return false;for(c in a)if(a[c])switch(typeof a[c]){case "object":if(!Object.isEqual(a[c],b[c]))return false;break;case "function":if(typeof b[c]=="undefined"||a[c].toString()!=b[c].toString())return false;break;default:if(a[c]!=b[c])return false}else if(b[c])return false;for(c in b)if(typeof a[c]=="undefined")return false;return true};Object.extend(Function.prototype,{bind:function(){if(arguments.length<2&&typeof arguments[0]=="undefined")return this;var a=this,b=$JSKK.toArray(arguments),c=b.shift();return function(){return a.apply(c,b.concat($JSKK.toArray(arguments)))}},curry:function(){if(!arguments.length)return this;var a=this,b=$JSKK.toArray(arguments);return function(){return a.apply(this,b.concat($JSKK.toArray(arguments)))}},intercept:function(){if(!(arguments.length<1&&typeof arguments[0]!="function")){var a=this,b=$JSKK.toArray(arguments),
c=b.shift();return function(){c.apply(this,b.concat($JSKK.toArray(arguments)));return a.apply(this,b.concat($JSKK.toArray(arguments)))}}},join:function(){if(!(arguments.length<1&&typeof arguments[0]!="function")){var a=this,b=$JSKK.toArray(arguments),c=b.shift();return function(){a.apply(this,b.concat($JSKK.toArray(arguments)));return c.apply(this,b.concat($JSKK.toArray(arguments)))}}},sequencedJoin:function(){if(!(arguments.length<1&&typeof arguments[0]!="function")){var a=this,b=$JSKK.toArray(arguments),
c=b.shift();return function(){var d=a.apply(this,b.concat($JSKK.toArray(arguments)));return Object.isNull(d)?null:Object.isAssocArray(d)&&Object.isDefined(d.args)?c.apply(this,d.args):c.call(this,d)}}},defer:function(){var a=this,b=$JSKK.toArray(arguments),c=b.shift(),d=b.shift(),e=b.shift();Object.isArray(e)||(e=[e]);window.setTimeout(function(){a.apply(d,e)},c)},delay:function(){arguments[0]*=1E3;this.defer.apply(this,arguments)}});var $break={};
Object.extend(Array.prototype,{_each:function(a){for(var b=0,c=this.length;b<c;b++)a(this[b])},each:function(a){var b=0;try{this._each(function(c){a(c,b++)})}catch(c){if(c!=$break)throw c;}return this},find:function(a){var b;this.each(function(c,d){if(a(c,d))throw b=c,$break;});return b},findAll:function(a){var b=[];this.each(function(c,d){a(c,d)&&b.push(c)});return b},first:function(){return this[0]},last:function(){return this[this.length-1]},inArray:function(a){return this.find(function(b){return a==b?
true:false})!=void 0?true:false},without:function(){if(Object.isArray(arguments[0])){var a=$JSKK.toArray(arguments[0]);return this.findAll(function(b){return!a.include(b)})}else return a=$JSKK.toArray(arguments),this.findAll(function(b){return!a.include(b)})},min:function(){return Math.min.apply(this,this)},max:function(){return Math.max.apply(this,this)},sum:function(){for(var a=0,b=0,c=this.length;b<c;b++)a+=Number(this[b]);return a},average:function(){return this.sum()/this.length}});Object.extend(String.prototype,{nl2br:function(){return this.replace(/[\r\n\f]/g,"<br />")},trim:function(){for(var a=this.replace(/^\s\s*/,""),b=/\s/,c=a.length;b.test(a.charAt(--c)););return a.slice(0,c+1)},toQueryParams:function(a){var b=this.trim().match(/([^?#]*)(#.*)?$/);return!b?{}:b[1].split(a||"&").inject({},function(a,b){if((b=b.split("="))[0]){var e=decodeURIComponent(b.shift()),f=b.length>1?b.join("="):b[0];Object.isUndefined(f)||(f=decodeURIComponent(f));e in a?(Object.isArray(a[e])||
(a[e]=[a[e]]),a[e].push(f)):a[e]=f}return a})},ellipse:function(a){return this.length>a?this.substr(0,a-3)+"...":this},lowerFirst:function(){var a=this.substring(0,1),b=this.substring(1);return a.toLowerCase()+b}});var $JSKK={version:"1.0.2",emptyFunction:function(){},namespace:function(){var a=/^(?:[\$a-zA-Z_]\w*[.])*[\$a-zA-Z_]\w*$/;return function(b,c){var d;d=b;var e=c||window,f;if(Object.isString(d)){var g,j;if(!a.test(d))throw Error('"'+d+'" is not a valid name for a package.');g=e;j=d.split(".");e=0;for(f=j.length;e<f;e++)d=j[e],g[d]=g[d]||{},g=g[d]}else throw new TypeError;return g}}(),usingPackage:function(){var a=arguments;return function(b){return b.apply(a[0],a)}},toArray:function(a){if(!a)return[];
if(!(typeof a=="function"&&a=="[object NodeList]")&&a.toArray)return a.toArray();for(var b=a.length||0,c=Array(b);b--;)c[b]=a[b];return c}};if(Object.isUndefined(window.console))window.console={log:$JSKK.emptyFunction,debug:$JSKK.emptyFunction,warn:$JSKK.emptyFunction,info:$JSKK.emptyFunction,trace:$JSKK.emptyFunction};else if(Object.isUndefined(window.console.debug))window.console.debug=window.console.log;$JSKK.Interface={create:function(a){if(Object.isString(a)){var b=window,c=a,d={};d.$name=a;d.$namespace="window";a=d}else if(Object.isUndefined(a.$name))throw Error("Interface name must be defined.");else c=a.$name,Object.isUndefined(a.$namespace)?(a.$namespace="window",b=window):b=$JSKK.namespace(a.$namespace);b[c]=function(){throw['Interface "'+c+'" cannot be initiated because interfaces'," are abstract classes which cannot be directly initiated."].join("");};a.$type="interface";b[c].prototype.$reflect=
function(b){switch(b){case "type":return a.$type;case "namespace":return a.$namespace;case "name":return a.$name;case "extends":return a.$extends;case "implements":return a.$implements}};return function(e){if(!Object.isUndefined(a.$extends))if(a.$extends.definition.$type=="trait")throw Error("Interfaces cannot extend Traits.");else if(a.$extends.definition.$type=="class")throw Error("Interfaces cannot extend Classes.");else b[c].prototype=Object.extend(b[c].prototype,a.$extends.prototype);if(!Object.isUndefined(a.$implements))throw Error("Interfaces cannot implement other Interfaces. Interfaces can only extend other Interfaces.");
for(var d in e)if(Object.isFunction(e[d])&&e[d]!=$JSKK.Interface.METHOD)throw Error("Interfaces may only contain empty functions. Use $JSKK.Interface.METHOD.");else b[c].prototype[d]=e[d]}},PROPERTY:function(){},METHOD:function(){},validate:function(a){if(Object.isUndefined(a))throw Error("Unable to implement interface. Interface to implement is undefined.");else if(a.$type=="class")throw Error(['Unable to implement interface. Interface to implement is a "$JSKK.Class".',' An interface must be a "$JSKK.Interface".']);
else if(a.$type=="trait")throw Error(['Unable to implement interface. Interface to implement is a "$JSKK.Trait".',' An interface must be a "$JSKK.Interface".']);else if(a.$type=="interface")throw Error('Unable to implement interface. Interface to implement is not an instance of "$JSKK.Interface".');return true},add:function(a,b,c,d){for(var e in d.prototype)if(e!="interfaceName"){if(d.prototype[e]==$JSKK.Interface.METHOD&&!Object.isFunction(b[e])&&(!c||!Object.isFunction(c.prototype[e])))throw Error(['The implementation of interface "'+
d.prototype.interfaceName+'" requires',' the method "'+e+'" be implemented.'].join(""));a.prototype[e]=Object.isAssocArray(d.prototype[e])?Object.clone(d.prototype[e]):d.prototype[e]}}};$JSKK.Trait={create:function(a){if(typeof a=="string"){var b=window,c=a,d={};d.$name=a;d.$namespace="window";a=d}else if(typeof a.$name=="undefined")throw Error("Trait name must be defined.");else c=a.$name,typeof a.$namespace=="undefined"?(a.$namespace="window",b=window):b=$JSKK.namespace(a.$namespace);b[c]=function(){throw['Trait "'+c+'" cannot be initiated because traits'," are abstract classes which cannot be directly initiated."].join("");};a.$type="trait";b[c].prototype.$reflect=function(b){switch(b){case "type":return a.$type;
case "namespace":return a.$namespace;case "name":return a.$name;case "extends":return a.$extends;case "implements":return a.$implements;case "uses":return a.$uses}};return function(e){var d=false;if(!Object.isUndefined(a.$uses)){if(!Object.isArray(a.$uses))a.$uses=[a.$uses];d=$JSKK.Trait.normalize(a.$uses,true)}if(!Object.isUndefined(a.$implements)){if(!Object.isArray(a.$implements))a.$implements=[a.$implements];for(var g=0,j=a.$implements.length;g<j;g++)$JSKK.Interface.validate(a.$implements[g])&&
$JSKK.Interface.add(b[c],e,d,a.$implements[g])}Object.isUndefined(a.$uses)||$JSKK.Trait.validate(d)&&$JSKK.Trait.add(b[c],d);for(var i in e)if(typeof e[i]!="function")throw Error("A trait may only contain methods.");else b[c].prototype[i]=e[i]}},normalize:function(a,b){Object.isArray(a)||(a=[a]);var c={};Object.isFunction(a[a.length-1])||(c=a[a.length-1],delete a[a.length-1]);var d=function(){};d.prototype.traitName="Normalized";for(var e=[],f=[],g=0,j=a.length;g<j;g++)if(Object.isFunction(a[g]))for(var i in a[g].prototype)if(Object.isFunction(a[g].prototype[i])&&
(i!="init"||b))e.inArray(i)?f.inArray(i)||(Object.isUndefined(c[i])?delete d.prototype[i]:d.prototype[i]=c[i].prototype[i],f.push(i)):(e.push(i),d.prototype[i]=a[g].prototype[i]);return d},validate:function(a){if(Object.isUndefined(a))throw Error("Unable to add trait. Trait to add is undefined.");else if(Object.isUndefined(a.prototype.className))if(Object.isUndefined(a.prototype.instanceName)){if(Object.isUndefined(a.prototype.traitName))throw Error('Unable to add trait. Trait to add is not an instance of "$JSKK.Trait".');
}else throw Error(['Unable to add trait. Trait to add is an instance of "$JSKK.Interface".',' A trait must be an instance of "$JSKK.Trait".']);else throw Error(['Unable to add trait. Trait to add is an instance of "$JSKK.Class".',' A trait must be an instance of "$JSKK.Trait".']);return true},add:function(a,b){for(var c in b.prototype)if(c!="traitName"){if(!Object.isFunction(b.prototype[c]))throw Error("Attempt to add trait to class instance failed because trait contained an entity that was not a method. Traits may only contain methods.");
a.prototype[c]=b.prototype[c]}}};$JSKK.Class={create:function(a){if(typeof a=="string"){var b=window,c=a,d={};d.$name=a;d.$namespace="window";a=d}else if(Object.isUndefined(a.$name))throw Error("Class name must be defined.");else c=a.$name,Object.isUndefined(a.$namespace)?(a.$namespace="window",b=window):b=$JSKK.namespace(a.$namespace);a.$type="class";b[c]=function(){if(a.$abstract)throw'"'+c+'" is an abstract class and cannot be directly initiated.';var e=Object.clone(b[c].prototype),d=$JSKK.toArray(arguments);if(b[c].prototype.__behaviors.length)for(var g=
0,j=b[c].prototype.__behaviors.length;g<j;g++){var i=d.shift();b[c].prototype.__behaviors[g].call(this,i)}b[c].prototype=e;e=function(a,b){var c=function(a,b,d,e,g){var f=a[b].$parent;a[b].$parent=function(a,d){return function(){var g=null;if(!Object.isUndefined(e.definition.$extends))for(var f=e.definition.$extends,h=false;;)if(Object.isFunction(f.prototype[b])&&a[b]!==f.prototype[b]){h=true;g=c(a,b,d,f,arguments);break}else if(Object.isUndefined(f.definition.$extends))break;else f=f.definition.$extends;
h||(g=d.apply(a,arguments));return g}}(a,e.prototype[b]);d=d.apply(a,g);a[b].$parent=f;return d},e=function(a,b,d){var e=a[b];a[b]=function(){a[b].$parent=function(a,e){return function(){var g=null;if(!Object.isUndefined(d.definition.$extends))for(var f=d.definition.$extends,h=false;;)if(Object.isFunction(f.prototype[b])&&a[b]!==f.prototype[b]){h=true;g=c(a,b,e,f,arguments);break}else if(Object.isUndefined(f.definition.$extends))break;else f=f.definition.$extends;h||(g=e.apply(a,arguments));return g}}(a,
d.prototype[b]);return e.apply(a,arguments)}};if(!Object.isUndefined(b.$extends))for(object in b.$extends.prototype)if(Object.isFunction(a[object])&&Object.isFunction(b.$extends.prototype[object])&&a[object]!==b.$extends.prototype[object])e(a,object,b.$extends);else if(Object.isFunction(a[object]))for(var d=b.$extends;;)if(Object.isFunction(d.prototype[object])&&a[object]!==d.prototype[object]){e(a,object,d);break}else if(Object.isUndefined(d.definition.$extends))break;else d=d.definition.$extends};
Object.isUndefined(b[c].definition.$extends)||e(this,b[c].definition);Object.isFunction(this.init)&&this.init.apply(this,d)};return function(d,f){if(Object.isDefined(a.$extends))if(Object.isUndefined(a.$extends))throw Error("Unable to extend class. Class to extend from is undefined.");else if(a.$extends.definition.$type=="interface")throw Error("Unable to extend class from interface. Use $implements followed by interface.");else if(a.$extends.definition.$type=="trait")throw Error("Unable to extend class from trait. Use $uses followed by the trait or an array of traits.");
else if(Object.isFunction(a.$extends.prototype.$reflect))if(Object.isDefined(a.$extends.definition.$final)&&a.$extends.definition.$final)throw Error("Unable to extend class. Class to extend from is declared as final.");else{for(var g in a.$extends)if(a.$extends.definition.$statics.methods.inArray(g)||a.$extends.definition.$statics.properties.inArray(g))b[c][g]=a.$extends[g];a.$statics=Object.extend(a.$statics,a.$extends.definition.$statics);b[c].prototype=Object.extend(b[c].prototype,a.$extends.prototype)}else throw Error('Unable to extend class. Class to extend from is not an instance of "$JSKK.Class".');
g=false;if(!Object.isArray(b[c].prototype.__behaviors))b[c].prototype.__behaviors=[];if(!Object.isUndefined(a.$uses)){if(!Object.isArray(a.$uses))a.$uses=[a.$uses];g=$JSKK.Trait.normalize(a.$uses);for(var j=0,i=a.$uses.length;j<i;j++)Object.isFunction(a.$uses[j])&&Object.isFunction(a.$uses[j].prototype.init)&&b[c].prototype.__behaviors.push(a.$uses[j].prototype.init);if(!Object.isArray(a.$uses))a.$uses=[a.$uses]}if(!Object.isUndefined(a.$implements)){if(!Object.isArray(a.$implements))a.$implements=
[a.$implements];j=0;for(i=a.$implements.length;j<i;j++)$JSKK.Interface.validate(a.$implements[j])&&$JSKK.Interface.add(b[c],f,g,a.$implements[j])}Object.isUndefined(a.$uses)||$JSKK.Trait.validate(g)&&$JSKK.Trait.add(b[c],g);b[c].prototype.$reflect=function(d){switch(d){case "type":return a.$type;case "namespace":return a.$namespace;case "name":return a.$name;case "extends":return a.$extends;case "implements":return a.$implements;case "uses":return a.$uses;case "abstract":return a.$abstract||false;
case "final":return a.$final||false;case "self":return b[c]}};if(Object.isUndefined(a.$statics))a.$statics={properties:[],methods:[]};for(var h in d)Object.isFunction(d[h])?a.$statics.methods.push(h):a.$statics.properties.push(h),b[c][h]=Object.clone(d[h]);for(h in f)if(Object.isFunction(f[h])){if(f[h]===$JSKK.Class.ABSTRACT_METHOD)if(a.$abstract)b[c].prototype[h]=Object.clone(f[h]);else throw'"'+c+'" contains one or more abstract methods and must be declared as abstract.';Object.isFunction(b[c].prototype[h])?
(g=b[c].prototype[h],b[c].prototype[h]=f[h],b[c].prototype[h].$parent=g):b[c].prototype[h]=Object.isAssocArray(f[h])?Object.clone(f[h]):f[h]}else b[c].prototype[h]=Object.isAssocArray(f[h])?Object.clone(f[h]):f[h];for(h in b[c].prototype)if(Object.isFunction(b[c].prototype[h])&&b[c].prototype[h]===$JSKK.Class.ABSTRACT_METHOD&&!a.$abstract)throw['"'+h+'" is an abstract method and so must either be defined or the class ',' "'+c+'" must be declared as abstract by defining'," $abstract:true in the class definition."].join("");
b[c].toString=function(){return"[JSKK Class ("+a.$namespace+"."+a.$name+")]"};b[c].definition=a}},ABSTRACT_METHOD:function(){}};$JSKK.Class.create({$namespace:"$JSKK",$name:"When"})({},{timer:null,items:{length:0},init:function(){this.timer=null;this.startTimer()},startTimer:function(){if(Object.isNull(this.timer))this.timer=window.setInterval(function(){for(var a in this.items)if(a!="length")try{this[this.items[a].condition](this.items[a])}catch(b){throw this.removeItem(this.items[a].id),b;}}.bind(this),100)},stopTimer:function(){window.clearInterval(this.timer);this.timer=null},captureCondition:function(a,b,c){c=$JSKK.toArray(c);
c.length?(this.items[b].condition=a,this.items[b].callback=c.shift(),this.items[b].args=c):this.removeItem(b)},addItem:function(a,b){var c=Math.round(Math.random()*1E6);this.items[c]={id:c,scope:a,object:b,condition:null,callback:$JSKK.emptyFunction,args:null};this.items.length++;this.items.length&&this.startTimer();return c},removeItem:function(a){delete this.items[a];this.items.length--;this.items.length||this.stopTimer()},assert:function(a,b){a&&(b.callback.apply(b.callback,b.args),this.removeItem(b.id))},
isDefined:function(a){this.assert(Object.isDefined(a.scope[a.object]),a)},isUndefined:function(a){this.assert(Object.isUndefined(a.scope[a.object]),a)},isTrue:function(a){Object.isFunction(a.scope)?this.assert(a.scope()===true,a):this.assert(a.scope[a.object]===true,a)},isFalse:function(a){Object.isFunction(a.scope)?this.assert(a.scope()===false,a):this.assert(a.scope[a.object]===false,a)},isBoolean:function(a){this.assert(Object.isBoolean(a.scope[a.object]),a)},isFunction:function(a){this.assert(Object.isFunction(a.scope[a.object]),
a)},isArray:function(a){this.assert(Object.isArray(a.scope[a.object]),a)},isAssocArray:function(a){this.assert(Object.isAssocArray(a.scope[a.object]),a)},isString:function(a){this.assert(Object.isString(a.scope[a.object]),a)},isNumber:function(a){this.assert(Object.isNumber(a.scope[a.object]),a)},isElement:function(a){this.assert(Object.isElement(a.scope[a.object]),a)},isNull:function(a){this.assert(Object.isNull(a.scope[a.object]),a)},isEqualTo:function(a){this.assert(a.scope[a.object.object]==a.object.value,
a)},isNotEqualTo:function(a){this.assert(a.scope[a.object.object]!=a.object.value,a)}});$JSKK.When=new $JSKK.When;
$JSKK.when=function(a,b){var c=$JSKK.When.addItem(a,b),d=arguments.callee,e={andWhen:function(){return arguments.length?d(arguments[0],arguments[1]):d(a,b)}};return{isDefined:function(){$JSKK.When.captureCondition("isDefined",c,arguments);return e},isUndefined:function(){$JSKK.When.captureCondition("isUndefined",c,arguments);return e},isTrue:function(){$JSKK.When.captureCondition("isTrue",c,arguments);return e},isFalse:function(){$JSKK.When.captureCondition("isFalse",c,arguments);return e},isBoolean:function(){$JSKK.When.captureCondition("isBoolean",
c,arguments);return e},isFunction:function(){$JSKK.When.captureCondition("isFunction",c,arguments);return e},isArray:function(){$JSKK.When.captureCondition("isArray",c,arguments);return e},isAssocArray:function(){$JSKK.When.captureCondition("isAssocArray",c,arguments);return e},isString:function(){$JSKK.When.captureCondition("isString",c,arguments);return e},isNumber:function(){$JSKK.When.captureCondition("isNumber",c,arguments);return e},isElement:function(){$JSKK.When.captureCondition("isElement",
c,arguments);return e},isNull:function(){$JSKK.When.captureCondition("isNull",c,arguments);return e},isEqualTo:function(){$JSKK.When.captureCondition("isEqualTo",c,arguments);return e},isNotEqualTo:function(){$JSKK.When.captureCondition("isNotEqualTo",c,arguments);return e}}};$JSKK.Interface.create({$namespace:"$JSKK.iface",$name:"Configurable"})({config:{}});$JSKK.Interface.create({$namespace:"$JSKK.iface",$name:"Observable"})({events:[],observe:$JSKK.Interface.METHOD,unobserve:$JSKK.Interface.METHOD,fireEvent:$JSKK.Interface.METHOD});$JSKK.Trait.create({$namespace:"$JSKK.trait",$name:"Configurable",$implements:$JSKK.iface.Configurable})({init:function(a){Object.extend(this.config,a)}});$JSKK.Trait.create({$namespace:"$JSKK.trait",$name:"Observable",$implements:$JSKK.iface.Observable})({init:function(a){for(var b in a)if(!Object.isFunction(a[b])&&Object.isAssocArray(a[b]))if(Object.isDefined(a[b].callback))Object.isDefined(a[b].times)?this.observeTimes(a[b].times,b,a[b]):this.observe(b,a[b]);else throw Error('Invalid observer. Observers defined as objects must specify "callback" as the callback function.');else if(Object.isFunction(a[b]))this.observe(b,a[b]);else throw Error("Invalid observer. Observers can only be functions.");
},observe:function(a,b){Object.isArray(this.events[a])||(this.events[a]=[]);Object.isArray(a)||(a=[a]);for(var c=0,d=a.length;c<d;c++)this.events[a[c]].push(b),this.events[a[c]].last().times=0;return this},observeOnce:function(a,b){return this.observeTimes.call(this,1,a,b)},observeTimes:function(a,b,c){Object.isArray(this.events[b])||(this.events[b]=[]);Object.isArray(b)||(b=[b]);for(var d=0,e=b.length;d<e;d++)this.events[b[d]].push(c),this.events[b[d]].last().times=a;return this},unobserve:function(a,
b){Object.isArray(a)||(a=[a]);for(var c=0,d=a.length;c<d;c++){if(!Object.isUndefined(this.events[a[c]]))for(var e=[],f=0,g=this.events[a[c]].length;f<g;f++)this.events[a[c]][f]==b?delete this.events[a[c]][f]:e.push(this.events[a[c]][f]);this.events[a[c]]=e;this.events[a[c]].length||(this.events[a[c]]=true)}return this},fireEvent:function(){var a=$JSKK.toArray(arguments),b=a.shift();Object.isArray(b)||(b=[b]);for(var c=0,d=b.length;c<d;c++)if(!Object.isUndefined(this.events[b[c]])&&Object.isArray(this.events[b[c]]))for(var e=
0,f=this.events[b[c]].length;e<f;e++)if(Object.isFunction(this.events[b[c]][e])){if(this.events[b[c]][e].apply(this,a)===false)return false;Object.isDefined(this.events[b[c]][e])&&this.events[b[c]][e].times!==0&&--this.events[b[c]][e].times===0&&this.unobserve(b[c],this.events[b[c]][e])}return true},clearEvent:function(a){Object.isUndefined(this.events[a])||(this.events[a]=true);return this}});$JSKK.Trait.create({$namespace:"$JSKK.trait",$name:"Timeable",$traits:$JSKK.trait.Observable})({startTimer:function(){if(this.config.timeout)this.timeout=this.config.timeout,window.clearInterval(this.timer),this.timer=window.setInterval(function(){this.timeout--;this.fireEvent("onTimerInterval",this,this.getElapsedTime());this.timeout<=0&&(window.clearInterval(this.timer),this.fireEvent("onTimeout",this))}.bind(this),1E3)},restartTimer:function(){this.startTimer()},pauseTimer:function(){window.clearInterval(this.timer)},
resumeTimer:function(){this.startTimer()},stopTimer:function(){window.clearInterval(this.timer);this.timeout=this.config.timeout},resetTimer:function(){this.timeout=this.config.timeout},getElapsedTime:function(){return this.config.timeout-this.timeout},getRemainingTime:function(){return this.timeout}});
